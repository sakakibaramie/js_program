data = {
  level1: ["レベル1です", "レベル1ですよ", "レベル1でした"],
  level1p: ["レベル準1です", "レベル準1ですよ", "レベル準1でした"],
  level2: [
    "　料理をする際、調味料の組み合わせを工夫すると、味に深みが出ることがあります。基本的なものとして、しょうゆとみりんのような組み合わせがよく知られていますが、実は意外な組み合わせが料理を格段においしくすることもあります。最近では、レシピサイトや動画でさまざまな提案がされており、新たな発見をする機会も増えてきました。そんな中で、特に注目されている調味料の使い方を紹介しましょう。n　これを簡単にいえば、一般的に別々に使われる調味料を、あえて組み合わせることで、相乗効果を生み出すというものです。たとえば、みそとヨーグルトを合わせると、乳酸菌の働きでよりまろやかになり、肉や魚の漬け込みにも使えます。また、塩と砂糖を少量ずつ混ぜることで、それぞれの味を引き立てつつ、甘みや塩味を際立たせることができます。他にも、ソースに少量の酢を加えると味が締まり、よりバランスの取れた仕上がりになるといわれています。n　このような調味料の使い方が注目される背景には、食の多様化や健康志向の高まりがあるといわれています。単においしさを追求するだけでなく、減塩や低糖質を意識しながら、素材の味を最大限に生かす方法が求められているのです。また、SNSなどで手軽に情報を共有できるようになり、新しいレシピが広まりやすくなったことも、大きな要因の一つとされています。n　実際に試した人の中には、カレーに少量のココアを加えることで、コクが増してより深みのある味わいになったという報告もあります。他にも、しょうゆにオレンジジュースを加えると、さっぱりとした風味が生まれ、ドレッシングや照り焼きのタレとして活用できると話題になっています。こうした調味料の組み合わせが広がることで、料理の楽しみ方もさらに増えていくことでしょう。",
    "　わたしたちは、毎日の生活の中で時計を使っています。朝起きるとき、学校や仕事へ行くとき、待ち合わせをするときなど、時間を知ることはとても大切です。しかし、時計は昔から今のような形だったわけではありません。どのように発展してきたのでしょうか。n　むかしの人々は、太陽の動きを見て時間を知っていました。特に「日時計」という道具が使われていました。これは、地面に立てた棒の影の長さや向きを見て時間を測る仕組みです。ただし、夜や天気の悪い日には使えないという欠点がありました。そこで、別の方法も考え出されました。その一つが「水時計」です。これは、水が一定の速さで落ちることを利用して時間を測る仕組みで、古代エジプトや中国などで使われていたといわれています。また、ろうそくや線香が燃える速さを利用した時計もありました。n　機械式の時計が作られるようになったのは、ヨーロッパの中世時代とされています。最初の時計は、ぜんまいを巻いて動かす仕組みでしたが、時間のずれが大きいという問題がありました。その後、振り子の動きを利用した「振り子時計」が発明され、時間をより正確に測れるようになりました。振り子時計は、18世紀ごろには広く使われるようになり、街の教会や広場に大きな時計塔が建てられたこともありました。n　時計はその後、小型化が進み、持ち運べる「懐中時計」が登場しました。19世紀になると、腕につけられる「腕時計」も作られるようになり、より便利になっていきました。さらに、20世紀には電気を使った「クオーツ時計」が開発されました。クオーツ時計は、機械式の時計よりも正確で、電池で動くため便利でした。この技術のおかげで、時計はより安く作れるようになり、多くの人が気軽に持てるようになりました。",
    "　子どものころに風船で遊んだことがある人は多いでしょう。誕生日やお祭りなどで見かけることもあり、ふわふわと浮かぶ風船は見ているだけでも楽しいものです。しかし、風船がどのような仕組みで膨らみ、浮かぶのかを考えたことはあるでしょうか。n　まず、風船はゴムやプラスチックなどの伸び縮みする素材でできています。風船を膨らませるとき、わたしたちは口やポンプを使って空気を中に入れます。空気が風船の中に入ると、ゴムが伸びて膨らみます。このとき、ゴムは元の形に戻ろうとする力を持っているため、内部の空気が外に押し出されようとします。しかし、風船の口をしっかり閉じれば空気は外に出ず、そのまま膨らんだ状態を保つことができます。n　また、ヘリウムガスを入れると、風船が浮くことがあります。これは、ヘリウムの密度が空気よりも軽いからです。風船の中にヘリウムを入れると、周囲の空気よりも軽くなるため、上へと浮かびます。同じ理由で、水に入れた氷が浮くのと似た原理です。この性質を利用して、大きな気球や飛行船も作られています。n　さらに、風船を飛ばしたときの動きについても興味深い点があります。風船の口を開けると、中の空気が勢いよく外に出ていきます。このとき、風船は反対方向へと進みます。これは「作用・反作用の法則」と呼ばれるもので、ロケットが宇宙へ飛び立つ仕組みにも応用されています。n　風船はシンプルなおもちゃのように見えますが、その仕組みにはさまざまな科学の原理が関わっています。身近なものでも、少し視点を変えてみると新たな発見があるかもしれません。",
  ],
  level2p: [
    "　料理をする前に、冷蔵庫の中身を確認する人は多いでしょう。食材が足りなければ買い足す必要がありますし、消費期限が近いものがあれば優先的に使った方がよいでしょう。わたしも毎日、夕食を作る前に必ずチェックしています。いつも見ているレシピサイトでは、しばしば料理に関する豆知識が紹介されるので、それも楽しみにしています。n　ある日の記事は、卵の鮮度の見分け方についてでした。わたしには、賞味期限を過ぎたら食べられないという認識しかなかったので、全く知りませんでしたが、実は水に浮くかどうかが目安になるそうです。新鮮な卵は水に沈み、時間がたつにつれて中の空気が増え、浮きやすくなると解説されていました。古くなると立つようになり、最終的には完全に浮くそうです。海外では、この方法で安全性を判断するのが一般的らしく、家庭で簡単に試せる点が便利だと紹介されていました。もし買ったばかりの卵が浮いてしまったら、さぞ驚くでしょうし、保管状態に問題があることは間違いありません。n　そして、なぜこのように変化するのかについても説明されていました。卵の殻には目に見えない小さな穴が無数にあり、時間がたつとそこから少しずつ水分が蒸発し、中に空気が入り込むためだそうです。そのため、鮮度が落ちるほど気室が大きくなり、浮きやすくなるとされています。しかし、完全に浮いたからといって必ずしも腐っているわけではなく、割ったときの匂いや状態で最終的に判断するのがよいとのことでした。わたしは画面にその様子が映ったとき、夕食の準備をしようとしていたにもかかわらず思わず見入ってしまいました。それは水の中で少しずつ角度を変えていく様子が確認でき、自然の仕組みの不思議さを感じさせるものでした。",
    "　道を歩いていると、街のあちこちで花壇を見かけることがあるでしょう。季節ごとに咲く花が変わるため、いつ通っても違った風景を楽しめます。わたしも毎日、通勤途中で立ち寄る公園の花壇を眺めるのが習慣になっています。そこには世話をしている人の名前が書かれた札が立っており、地域の人々が協力して手入れしていることが分かります。n　ある日、そこに植えられている花について調べたことがありました。わたしには、花の名前を詳しく知る習慣がなかったので、単にきれいだと思っていたのですが、実はそれぞれに特徴や意味があるのだと分かりました。特に、チューリップは色ごとに異なる花言葉を持っており、赤は愛情、黄色は希望を表すそうです。また、オレンジのものは元気を与える意味があると説明されていました。公園の花壇にはさまざまな色が植えられていたので、改めてそれらを意識しながら見ると、また違った印象を受けるようになりました。もし自宅の庭に花を植える機会があれば、その意味を考えて選ぶのも面白いかもしれません。n　そして、花の色がなぜこんなに多様なのかについても調べてみました。植物は昆虫を引き寄せるために目立つ色を持つとされており、花粉を運んでもらうために進化した結果だそうです。特に、ミツバチは黄色や青を好むため、その色の花が多いとされています。しかし、人間の目には赤が鮮やかに映るため、観賞用として品種改良が進み、現在のようにさまざまな色が生まれたとのことでした。わたしは公園の花壇を見ながら、自然の工夫がそこに詰まっていることを改めて実感しました。それは単なる飾りではなく、生き物同士の関係が生み出した美しさなのだと気付かされる光景でした。",
    "　旅行に行くとき、事前に観光地の情報を調べる人は多いでしょう。現地の名物を確認しておけば、より充実した旅を楽しめますし、移動手段を考えておけば時間を有効に使えます。わたしも毎回、出発前にはガイドブックや旅行サイトを見ながら計画を立てるのが習慣になっています。いつも利用しているサイトでは、しばしば現地の歴史や文化に関する豆知識が紹介されるので、それも楽しみにしています。n　あるとき読んだ記事は、温泉の色の違いについてのものでした。わたしには、お湯の色が異なる理由など考えたこともなかったので、全く知らなかったのですが、実は含まれる成分によって変わるのだそうです。硫黄を多く含むと白濁し、鉄分が豊富だと赤みを帯びると解説されていました。特に青みがかった温泉は、温泉成分が光を反射することでそう見えるらしく、全国でも限られた場所でしか見られないそうです。もしそうした温泉に入る機会があれば、さぞ特別な気分になるでしょうし、写真に残しておきたくなることは間違いありません。n　そして、なぜ温泉にはこのような成分が含まれるのかについても説明されていました。地中深くの水は、火山活動によって熱せられる際にさまざまな鉱物を溶かし込むため、泉質が変化するのだそうです。そのため、同じ地域でも場所によって異なる性質の温泉が湧くことがあり、色や香り、効能に違いが生まれるとされています。特に、日本は火山が多いため、多様な温泉が楽しめる国として世界的にも知られているとのことでした。わたしはその説明を読んでいるうちに、次の旅行では珍しい泉質の温泉を巡ってみたいと考えるようになりました。それはただの入浴ではなく、自然の恵みを全身で感じられる貴重な体験になりそうだと感じたのです。",
  ],
  level3: [
    "レベル3ですよnレベル3ですよ",
    "　本を読んでいると、ときどき特定の単語が強調されているのを目にすることがあります。例えば、太字や斜体になっていたり、下線が引かれていたりする場合があります。こうした工夫によって、読者は大切な部分をすぐに見つけることができます。これはタイポグラフィと呼ばれ、印刷やデザインの分野で広く使われている技法の一つです。現在では、パソコンの文書作成ソフトにもさまざまな文字装飾の機能が搭載されているため、使い慣れている人も多いでしょう。n　では、なぜこのような技術が発展してきたのでしょうか。その歴史をたどると、活版印刷が普及した時代にさかのぼります。特にヨーロッパでは、印刷技術が発達するにつれて、読みやすさを向上させるための工夫がなされていきました。そして、日本にもそれが伝えられ、近代の新聞や雑誌でも積極的に取り入れられるようになりました。その中で、特定の情報を際立たせるための方法として、文字の形や太さを変える技法が広く使われるようになったのです。やがて、それが一般の文書作成にも応用され、現在のデジタル環境でも欠かせない要素となっています。n　このように、印刷やデザインの分野には、長い歴史を持つ技法が数多く存在しています。それにしても、視覚的な工夫が時代を超えて受け継がれているというのは、興味深いことではないでしょうか。",
    "　本を開くと、文章の途中に、横線や小さな数字が付いていることがあります。これは脚注や注釈と呼ばれるもので、本文では説明しきれない情報を補うために使われます。これがあるおかげで、読者は難しい用語や背景知識をその場で理解することができます。特に学術書や研究論文では、頻繁に用いられる形式の一つです。パソコンの文書作成ソフトにも、このような注を挿入する機能が備わっているため、実際に使ったことがある人も少なくないでしょう。n　では、なぜこのような仕組みが発展してきたのでしょうか。その起源をたどると、古代の写本文化に行き着きます。昔の学者たちは、重要な情報を補足するために、本文の余白に小さな文字で書き添える習慣がありました。やがて印刷技術が発達し、注釈を明確に区別するために脚注や巻末注の形式が生まれました。そして、それが現在の出版物にも受け継がれ、専門書だけでなく一般の書籍でも見られるようになったのです。n　このように、文章をより分かりやすくするための工夫は、古い時代から現代に至るまで続いています。それにしても、何世紀も前の学者たちの工夫が、今もなお活用されているというのは、興味深いことではないでしょうか。",
    "　新聞や雑誌の記事を読んでいると、見出しが目を引くことがあります。見出しは、記事の内容を簡潔に伝えるために工夫されており、一目で大まかな情報を把握できるようになっています。特に新聞では、限られたスペースの中で多くの情報を伝えるために、短く分かりやすい言葉が選ばれています。パソコンの文書作成ソフトにも、見出しのスタイルを設定できる機能があるため、使ったことがある人もいるでしょう。n　では、なぜ見出しはこのような形になったのでしょうか。その背景には、新聞の歴史があります。昔の新聞は活版印刷で作られており、文字を並べる作業に時間がかかっていました。そのため、重要な部分を目立たせる方法として、文字を大きくしたり、太くしたりする工夫が生まれました。そして、それが現在の新聞や雑誌の見出しの形へと発展していったのです。n　このように、新聞や印刷物には、長い歴史の中で培われた工夫がたくさん詰まっています。普段何気なく見ている見出しにも、過去からの工夫が息づいていると考えると、おもしろいものですね。",
    "　辞書を引くと、単語の意味のほかに、発音や使い方の例が載っていることがあります。これによって、言葉の意味を正確に理解し、適切に使うことができます。このような仕組みは、言葉を学ぶ上で欠かせないものです。特に外国語の辞書では、発音記号や文法の説明が詳しく書かれており、学習を助ける工夫がされています。パソコンやスマートフォンの辞書アプリにも、これらの機能が備わっているため、日常的に利用している人も多いでしょう。n　では、なぜ辞書にはこうした工夫が施されるようになったのでしょうか。その歴史をたどると、近代の言語学の発展が関係しています。かつての辞書は単に単語の意味を示すだけでしたが、言語の研究が進むにつれて、正しい発音や用例を示すことが重要視されるようになりました。そして、各国で辞書の編集が進められ、今のように詳細な情報が掲載されるようになったのです。n　このように、辞書は時代とともに進化し、より分かりやすく改良されてきました。普段何気なく使っている辞書ですが、その一冊には、長い歴史と多くの工夫が詰まっているのですね。",
  ],
  startTime: 10,
  finishFlag: false,
  interval: "", // SetInterval用
  nowLevel: "",
  nowLevelNum: 0,
  missCount: 0,
  timerButtonFlag: false,
  nowText: 0,
  enterdText: 0,
};

let levelSelect = document.getElementById("levelSelect");
let txarea = document.getElementById("txarea");
let op = document.getElementById("op");
let text = document.getElementById("text");
let startButton = document.getElementById("startButton");
let timer = document.getElementById("timer");
let kekka = document.getElementById("kekka");
let textChange = document.getElementById("textChange");

document.getElementById("help").addEventListener("click", function () {
  alert(
    "これはワープロ検定のタイピング試験の練習サイトです\n1.練習したい級を選ぶ\n2.課題文を変えたい場合は「テキストチェンジ」ボタンを押下\n3.「スタート」ボタン押下でタイマースタート\n4.スペース、改行含めて全て入力が完了すると終了\n＊終了すると「正しく入力できた文字数」が表示されますが正確なものではないため目安程度にしてください"
  );
});

function dataReset() {
  data.missCount = 0;
  data.nowText = 0;
  data.enterdText = 0;
}

startButton.addEventListener("click", function () {
  if (data.timerButtonFlag == true) {
    dataReset();
    this.disabled = true; // スタートボタン非活性
    textChange.disabled = true; // テキスト変更ボタン非活性
    levelSelect.disabled = true; // 級選択非活性

    let targetTime = data.startTime * 60;

    function updateCountDown() {
      let minutes = Math.floor(targetTime / 60);
      let seconds = targetTime % 60;
      timer.textContent = `残り${minutes}分${seconds}秒`;
      targetTime--;
      if (targetTime < 0) {
        clearInterval(data.interval);
        timer.textContent += "　終了！！！！！！";
        this.disabled = false;
        txarea.readOnly = true;
        levelSelect.disabled = false; // 級選択可能
        textChange.disabled = false; // テキストチェンジ可能
        kekka.innerHTML += `　正しく入力できた文字数：${
          data.enterdText - data.missCount
        }`;
      }
    }

    data.interval = setInterval(updateCountDown, 1000);
  } else {
    alert("問題文を選択してください");
  }
});

levelSelect.addEventListener("change", function () {
  data.timerButtonFlag = true;
  txarea.readOnly = false;
  startButton.disabled = false;
  kekka.innerHTML = "";
  let level = this.value;
  // console.log(level);
  textDisp(level);

  function textDisp(n) {
    // nは受験級の値
    let level = levelReplace(n); // オブジェクトのプロパティに指定できるよう別関数で置換
    data.nowLevel = level;
    let num = random(data[data.nowLevel].length);
    data.nowLevelNum = num;
    let textData = data[data.nowLevel][num];
    text.innerHTML = "";
    txarea.value = "";
    for (let i = 0; i < textData.length; i++) {
      if (textData[i] == "n") {
        text.innerHTML += "<br>";
      } else {
        text.innerHTML += textData[i];
      }
    }
  }
});

// 乱数生成
function random(n) {
  return Math.floor(Math.random() * n);
}

function levelReplace(n) {
  let text = "";
  if (n == "1") {
    text = "level1";
  }
  if (n == "準1") {
    text = "level1p";
  }
  if (n == "2") {
    text = "level2";
  }
  if (n == "準2") {
    text = "level2p";
  }
  if (n == "3") {
    text = "level3";
  }
  return text;
}

// テキスト変更の処理
textChange.addEventListener("click", function () {
  startButton.disabled = false;
  let num = random(data[data.nowLevel].length);
  data.nowLevelNum = num;
  let textData = data[data.nowLevel][num];
  text.innerHTML = "";
  txarea.value = "";
  kekka.innerHTML = "";
  timer.innerHTML = "";
  txarea.readOnly = false;
  op.innerHTML = "";
  for (let i = 0; i < textData.length; i++) {
    if (textData[i] == "n") {
      text.innerHTML += "<br>";
    } else {
      text.innerHTML += textData[i];
    }
  }
});

// 文字入力時のイベント（正確には全角文字入力確定時のイベント）
txarea.addEventListener("compositionend", function (e) {
  let enterdText = "";
  let nowText = data[data.nowLevel][data.nowLevelNum];
  enterdText = this.value;
  enterdText = enterdText.replaceAll("\n", "n");
  console.log(`nowText:${nowText}`);
  console.log(`enterdText:${enterdText}`);
  for (let i = 0; i < enterdText.length; i++) {
    if (enterdText[i] != nowText[i]) {
      op.textContent = "ミスしてます！！";
      data.missCount++;
    } else {
      op.textContent = "";
    }
    kekka.innerHTML = `ミスカウント：${data.missCount}`;
  }

  if (enterdText == nowText) {
    clearInterval(data.interval);
    data.timerButtonFlag = false; // 「スタート」ボタン押下可能
    document.getElementById("textChange").disabled = false; // テキスト変更ボタン押下可能
    levelSelect.disabled = false; // 級選択可能
    txarea.readOnly = true; // 入力不可
    textChange.disabled = false; // テキストチェンジ可能
    alert("クリア！");
    kekka.innerHTML += `　正しく入力できた文字数：${
      nowText.length - data.missCount
    }`;

    //console.log("終わり");
  }
  data.enterdText = enterdText.length;
});

// https://gray-code.com/javascript/detect-the-start-and-end-of-full-width-input/
